- hosts: localhost
  connection: local
  gather_facts: true

  vars:
    # –ü–∞–∫–µ—Ç—ã –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Arch/CachyOS
    pacman_packages:
      - docker
      - docker-compose
      - telegram-desktop
      - discord
      - gramps
      - libreoffice-fresh
      - qbittorrent
      - thunderbird
      - firefox
      - virtualbox
      - virtualbox-host-dkms
      - vlc
      - vlc-plugins-all
      - vlc-gui-skins2
      - ruff
      - uv
      - neovim
      - yt-dlp
      - ttf-jetbrains-mono
      - github-cli
      - zed
      - ghostty
      - btop
      - eza
      - fd
      - yazi
      - ffmpeg
      - jq
      - ripgrep
      - fzf
      - zoxide
      - nerd-fonts
      - procs
      - duf
      - dust
      - lazygit
      - graphviz
      - tree
      - broot
      - okular
      - texlive-basic
      - texlive-latex
      - texlive-latexrecommended
      - texlive-latexextra
      - texlive-fontsrecommended
      - texlive-fontsextra
      - texlive-langcyrillic
      - texlive-langenglish
      - texlive-mathscience
      - texmaker
      - handbrake
      - kdenlive

    # –ü–∞–∫–µ—Ç—ã –∏–∑ AUR
    aur_packages:
      - lazydocker
      - lmstudio
      - obsidian
      - yandex-browser
      - warp-terminal
      - throne-bin
      - cursor-bin
      - slack-desktop
      - visual-studio-code-bin
      - zoom
      - peazip

  pre_tasks:
    - name: üëâ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π CachyOS
      become: true
      pacman:
        name: cachyos-keyring
        state: latest

    - name: üëâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
      become: true
      pacman:
        update_cache: yes

  tasks:
    - name: üëâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
      become: true
      pacman:
        upgrade: yes

    - name: üëâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 'base-devel' –¥–ª—è —Å–±–æ—Ä–∫–∏ AUR –ø–∞–∫–µ—Ç–æ–≤
      become: true
      pacman:
        name: base-devel
        state: present

    - name: üëâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
      become: true
      pacman:
        name: "{{ pacman_packages }}"
        state: present

    - name: üëâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ AUR
      kewlfft.aur.aur:
        use: paru
        name: "{{ aur_packages }}"
        state: present
      become: false

    - name: üëâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
      become: true
      block:
        - name: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
          user:
            name: "{{ ansible_user_id }}"
            groups: docker
            append: yes

        - name: –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ Docker
          systemd:
            name: docker
            enabled: yes
            state: started

    - name: üëâ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ git
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: |
        git config --global core.quotepath false
        
    - name: üëâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Rust
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: |
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
      args:
        creates: "{{ ansible_env.HOME }}/.cargo/bin/rustc"

    - name: üëâ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π –¥–ª—è uv
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: |
        echo 'uv generate-shell-completion fish | source' > ~/.config/fish/completions/uv.fish
        echo 'uvx --generate-shell-completion fish | source' > ~/.config/fish/completions/uvx.fish

    - name: üîë –£—Å—Ç–∞–Ω–æ–≤–∫–∞ JetBrains Toolbox
      tags: vpn
      kewlfft.aur.aur:
        use: paru
        name: jetbrains-toolbox
        state: present
      become: false

    - name: üîë –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Julia
      tags: vpn
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: |
        curl -fsSL https://install.julialang.org | sh -s -- --yes

    - name: üëâ –î–æ–±–∞–≤–∏—Ç—å –∞–ª–∏–∞—Å—ã –≤ fish
      blockinfile:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        marker: '##### {mark} ALIASES #####'
        block: |
          alias ls 'eza -lhoUm --icons --hyperlink --time-style iso --colour-scale=age --no-permissions'
          alias lsg 'eza -lhoUm --icons --hyperlink --time-style iso --colour-scale=age --no-permissions --git --git-repos'
          alias ll 'eza -lhagoUm --icons --hyperlink --time-style iso --colour-scale=age --smart-group'
          alias llg 'eza -lhagoUm --icons --hyperlink --time-style iso --colour-scale=age --smart-group --git --git-repos'
          alias lls 'eza -lhagoUm --icons --hyperlink --time-style iso --colour-scale=age --smart-group --total-size'
          alias as-tree 'tree --fromfile' # –ø–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ä–µ–≤–æ, –ø—Ä–∏–º–µ—Ä: fd -e rs | as-tree
          alias fda 'fd -u' # –ø–æ–∏—Å–∫ –≤–∫–ª—é—á–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ
          alias smi 'watch -n 1 -d nvidia-smi'
          alias fzf 'fzf --height 50% --layout reverse --info inline --border'
          alias fzfp "fzf --height 50% --layout reverse --info inline --border --preview 'bat --color=always {}' --preview-window '~3'"
          alias ps 'procs --watch'
          alias pst 'procs --tree'
          alias psc 'procs --watch --sortd cpu'
          alias psm 'procs --watch --sortd mem'
          alias lzg 'lazygit'
          alias lzd 'lazydocker'

    - name: üëâ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –≤ fish
      blockinfile:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        marker: '##### {mark} INTEGRATIONS #####'
        block: |
          fzf --fish | source
          zoxide init fish | source
          abbr -a --position anywhere -- --help '--help | bat -plhelp'
          abbr -a --position anywhere -- -h '-h | bat -plhelp'

    - name: üëâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π –¥–ª—è fish
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: |
        fish -c 'fish_update_completions'
        mkdir -p ~/.config/fish/completions
        procs --gen-completion-out fish > ~/.config/fish/completions/procs.fish

    - name: üëâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã tldr
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
      shell: fish -c 'tldr --update'

    - name: üëâ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ KDE Wallet
      ini_file:
        path: "{{ ansible_env.HOME }}/.config/kwalletrc"
        create: yes
        section: Wallet
        option: Enabled
        value: 'false'
        mode: '0644'
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"

    - name: üëâ –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à –¥–ª—è Spectacle
      blockinfile:
        path: "{{ ansible_env.HOME }}/.config/kglobalshortcutsrc"
        marker: "##### {mark} SPECTACLE SHORTCUTS #####"
        block: |
          [services][org.kde.spectacle.desktop]
          RectangularRegionScreenShot=Print
          _launch=Meta+Shift+Print\tMeta+Shift+S

    - name: üëâ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .config
      copy:
        src: "{{ playbook_dir }}/.config/"
        dest: "{{ ansible_env.HOME }}/.config/"
        mode: "0644"
        directory_mode: "0755"

    - name: üëâ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .local
      copy:
        src: "{{ playbook_dir }}/.local/"
        dest: "{{ ansible_env.HOME }}/.local/"
        mode: "0644"
        directory_mode: "0755"

    - name: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      debug:
        msg: |
          ========================================================================
          ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

          ‚ÑπÔ∏è –í–ê–ñ–ù–û: –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è Docker, NVIDIA, Julia –∏ VirtualBox
          –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä.

          –î–ª—è VirtualBox –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è:
          sudo modprobe vboxdrv
          ========================================================================
